
  {% extends "base.html" %}

  {% block title %}Home - Dublin Bikes{% endblock %}
  
  {% block content %}


    <div class="container">

      <div class="sidebar">

        {% if session.user %}
          <p>You chose <strong>{{ default_station.name }}</strong> as your default station, can be changed in your profile settings.</p>
        {% else %}
          <p>Using <strong>{{ default_station.name }}</strong> as default location, sign in if you want to change it.</p>
        {% endif %}

        <div class="location-search">
          <h3>Select a location on the map</h3>
          <p id="selected-location"></p>
          <p id="selected-location-distance"></p>
          <p id="selected-location-time"></p>
          <p id="selected-location-arrival"></p>
          <p id="selected-station-info"></p>
        </div>

        <div class="weather-forecast">
          <h3>Weather Forecast</h3>
          <label>
            <input type="radio" name="forecastType" value="current" checked>
            Current Weather
          </label>
          <label>
            <input type="radio" name="forecastType" value="forecast">
            Forecast
          </label>
        
          <div id="forecast-options" style="display:none; margin-top:1em;">
            <label for="forecast-date">Select Date:</label>
            <input type="date" id="forecast-date" 
                   min="{{ now.strftime('%Y-%m-%d') }}" 
                   max="{{ (now + timedelta(days=5)).strftime('%Y-%m-%d') }}">
            <div id="hour-selector" style="display:none; margin-top:0.5em;">
              <label for="forecast-hour">Select Hour:</label>
              <!-- step="3600" restricts selection to whole hours -->
              <input type="time" id="forecast-hour" step="3600" pattern="^(?:[01]\d|2[0-3]):00$">
            </div>
            <button onclick="fetchForecastWeather()">Get Forecast</button>
          </div>
        </div>
        
        
        <div class="weather">
          <h3>Weather Info</h3>

          <p>Showing Current Weather: <br><span id="timestamp-weatherinfo"></span></p>
          <p id="weather-temp"></p>
          <p id="weather-description"></p>
          <img id="weather-icon" alt="Weather Icon" style="width: 50px; height: 50px;">

        </div>
      </div>

      <div class="map">
        <!-- This div is the container where the map will be rendered -->
        <div id="map" style="height: 500px;"></div>
      </div>
  
      <!-- Embed the stations data into a global JS variable -->
      <script>
        const stations = {{ stations | tojson }};

        var defaultStation = {
        id: {{ default_station.station_id }},
       lat: {{ default_station.position_lat }},
       lng: {{ default_station.position_lng }}
      };
      </script>
    
      <!-- Load your custom script after defining 'stations' -->
      <script src="{{ url_for('static', filename='maps.js') }}"></script>

      <!-- Load the weather script -->
      <script src="{{ url_for('static', filename='weather.js') }}"></script>

    
      <!-- Google Maps API script with callback to initMap -->
      <script src="https://maps.googleapis.com/maps/api/js?key={{ mapskey }}&callback=initMap" async defer></script>

    </div>

  </body>


  {% endblock %}
