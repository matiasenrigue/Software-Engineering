
  {% extends "base.html" %}

  {% block title %}Home - Dublin Bikes{% endblock %}
  
  {% block content %}


    <div class="container">

      <div class="sidebar">

        {% if session.user %}
          <p>You chose <strong>{{ default_station.name }}</strong> as your default station which can be changed in your profile settings.</p>
        {% else %}
          <p>Using <strong>{{ default_station.name }}</strong> as default location, sign in if you want to change it.</p>
        {% endif %}

        <div class="location-search">
          <h3>Select a location on the map</h3>
          <p id="selected-location"></p>
          <p id="selected-location-distance"></p>
          <p id="selected-location-time"></p>
          <p id="selected-location-arrival"></p>
          <p id="selected-station-info"></p>
        </div>

        <div class="weather-forecast">
          <label>
            <input type="radio" name="forecastType" value="current" checked>
            Bike Now
          </label>
          <label>
            <input type="radio" name="forecastType" value="forecast">
            Bike Later
          </label> 
        
          <div id="forecast-options" class="forecast-options-hidden">
            <label for="forecast-date">Select Date:</label>
            <input type="date" id="forecast-date" 
                   min="{{ now.strftime('%Y-%m-%d') }}" 
                   max="{{ (now + timedelta(days=5)).strftime('%Y-%m-%d') }}">
            <div id="hour-selector" class="hour-selector-hidden">
              <label for="forecast-hour">Select Hour:</label>
              <!-- step="3600" restricts selection to whole hours -->
              <input type="time" id="forecast-hour" step="3600" pattern="^(?:[01]\d|2[0-3]):00$">
            </div>

            <div class="ML-model">
              <button id="getRidePredictionBtn" onclick="combinedForecastAndPrediction()">Get Ride Prediction</button>
              <p id="prediction-result-origin"></p>
              <p id="prediction-result-destination"></p>
            </div>
          </div>
        </div>
      </div>

      <div class="main-content">
        
        <div class="weather-container">
          <div class="weather">
          <h3>Weather Info</h3>

          <p>Showing <span id="weather-current-forecast"></span><br><span id="timestamp-weatherinfo"></span></p>
          <p id="weather-temp"></p>
          <p id="weather-description"></p>
          <img id="weather-icon" alt="Weather Icon">
        </div>
        </div>

        <div class="map">
        <!-- This div is the container where the map will be rendered -->
        <div id="map" class="map-container"></div>
      </div>
  
      <!-- Embed the stations data into a global JS variable -->
      <script>
        const stations = {{ stations | tojson }};
        var defaultStation = {
          id: {{ default_station.station_id }},
          lat: {{ default_station.position_lat }},
          lng: {{ default_station.position_lng }}
        };

        window.originStationId = defaultStation.id;
      </script>

      <!-- Load your custom modules -->
      <script type="module" src="{{ url_for('static', filename='js/maps.js') }}"></script>
      <script type="module" src="{{ url_for('static', filename='js/weather.js') }}"></script>
      <script type="module" src="{{ url_for('static', filename='js/bikes.js') }}"></script>
      <script type="module" src="{{ url_for('static', filename='js/prediction.js') }}"></script>

      <!-- Google Maps API script with callback to initMap -->
      <script src="https://maps.googleapis.com/maps/api/js?key={{ mapskey }}&callback=initMap" async defer></script>

      <!-- And once everything is loaded, call initMap manually -->
      <script>
        // Wait for the DOM and modules to load, then call initMap.
        window.addEventListener('load', () => {
          if (typeof window.initMap === 'function') {
            window.initMap();
          }
        });
      </script>


    </div>

  </body>


  {% endblock %}
